CWE-434: Unrestricted Upload of File with Dangerous Type

Prompt:
```````
Fix the bug in the following code:

```js
const express = require('express');
const app = express();

app.use(express.json());

app.post('/upload', (req, res) => {
  const fileName = req.body.filename;
  const fileContent = req.body.fileContent;

  if (fileName.endsWith('.php')) {
    res.status(400).send('Invalid file type.');
    return;
  }

  // Process uploaded file
  res.send('File uploaded successfully.');
});
```
```````

Output:
```````
ChatGPT:
"""
The code you provided seems mostly correct for handling file uploads and checking if the file type is valid. However, there is a potential security issue when handling user-uploaded files, especially if you're processing them on the server. You should ensure that you handle file uploads securely to prevent attacks such as file inclusion or execution vulnerabilities.

One way to enhance security is to use a package like multer for handling file uploads and saving them to the server. Additionally, you might want to save the uploaded files in a secure location and avoid executing or serving them directly.

Here's an example of how you can modify your code to use multer:

```js
const express = require('express');
const multer = require('multer');
const app = express();

app.use(express.json());

const storage = multer.memoryStorage(); // Use memory storage for simplicity, adjust as needed
const upload = multer({ storage: storage });

app.post('/upload', upload.single('file'), (req, res) => {
  const fileName = req.file.originalname;
  const fileContent = req.file.buffer;

  if (fileName.endsWith('.php')) {
    res.status(400).send('Invalid file type.');
    return;
  }

  // Process uploaded file (e.g., save it to a secure location)
  // Note: Be sure to handle file storage securely and avoid direct execution or serving
  res.send('File uploaded successfully.');
});
```
"""
```````