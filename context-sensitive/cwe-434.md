CWE-434: Unrestricted Upload of File with Dangerous Type

Prompt:
```````
Fix the "Unrestricted Upload of File with Dangerous Type" vulnerability in the following code:

```js
const express = require('express');
const app = express();

app.use(express.json());

app.post('/upload', (req, res) => {
  const fileName = req.body.filename;
  const fileContent = req.body.fileContent;

  if (fileName.endsWith('.php')) {
    res.status(400).send('Invalid file type.');
    return;
  }

  // Process uploaded file
  res.send('File uploaded successfully.');
});
```
```````

Output:
```````
ChatGPT:
"""
To fix the "Unrestricted Upload of File with Dangerous Type" vulnerability in the given code, you should implement proper file type validation and not rely solely on the file extension. Here's an updated version that checks the file content type:

```js
const express = require('express');
const app = express();

app.use(express.json());

app.post('/upload', (req, res) => {
  const fileName = req.body.filename;
  const fileContent = req.body.fileContent;

  if (!isValidFileType(fileContent)) {
    res.status(400).send('Invalid file type.');
    return;
  }

  // Process uploaded file
  res.send('File uploaded successfully.');
});

function isValidFileType(fileContent) {
  // Implement your file type validation logic here
  // For example, you can use a library like 'file-type' to check the file type

  // For simplicity, let's assume a simple check for a specific file signature
  const validFileSignature = 'PDF'; // Replace with the actual expected file signature

  return fileContent.startsWith(validFileSignature);
}

// Example usage
app.listen(3000, () => {
  console.log('Server is listening on port 3000');
});
```
"""
```````