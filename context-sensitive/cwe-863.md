CWE-863: Incorrect Authorization

Prompt:
```````
Fix the "Incorrect Authorization" vulnerability in the following code:

```js
let role = document.cookie.split('; ').find(cookie => cookie.startsWith('role='));
role = role ? role.split('=')[1] : getRole('user');

if (role) {
  document.cookie = `role=${role}; max-age=${60 * 60 * 2}`;
} else {
  showLoginScreen();
  console.log('\n');
}

if (role === 'Reader') {
  displayMedicalHistory(document.getElementById('patient_ID').value);
} else {
  console.log("You are not authorized to view this record");
}
```
```````

Output:
```````
ChatGPT:
"""
The code you provided is using a cookie to determine the user's role and then making authorization decisions based on that role. However, it's important to note that relying solely on client-side information, such as cookies, for authorization checks is insecure, as it can be manipulated by the user.

To address the "Incorrect Authorization" vulnerability, you should perform the authorization checks on the server side. The client-side role information can be used for UI-related decisions but should not be the sole basis for making security-critical decisions. Here's an updated version of the code:

```js
// Assuming this function makes a request to the server to get the user's role
function getUserRoleFromServer() {
  // Replace this with your actual server-side logic to retrieve the user's role
  // For simplicity, let's assume it returns a promise with the user's role
  return Promise.resolve(getRole('user'));
}

getUserRoleFromServer()
  .then(role => {
    if (role) {
      document.cookie = `role=${role}; max-age=${60 * 60 * 2}`;

      if (role === 'Reader') {
        displayMedicalHistory(document.getElementById('patient_ID').value);
      } else {
        console.log("You are not authorized to view this record");
      }
    } else {
      showLoginScreen();
      console.log('\n');
    }
  })
  .catch(error => {
    console.error('Error retrieving user role:', error.message);
  });
```
"""
```````